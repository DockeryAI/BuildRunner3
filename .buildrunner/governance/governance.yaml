# BuildRunner 3.0 Governance Configuration
# This file defines workflow rules, feature dependencies, validation requirements,
# and enforcement policies for the project.

project:
  name: "BuildRunner3"
  version: "3.0.0"
  governance_version: "1.0"
  description: "Git-backed governance system for AI-assisted project development"

# Workflow rules define how features can progress through states
workflow:
  rules:
    # Valid feature states
    allowed_states:
      - planned
      - in_progress
      - testing
      - complete
      - blocked

    # Valid state transitions
    transitions:
      planned:
        - in_progress
        - blocked
      in_progress:
        - testing
        - blocked
        - planned  # Can move back if needed
      testing:
        - complete
        - in_progress  # Can move back for fixes
        - blocked
      blocked:
        - planned
        - in_progress
      complete:
        []  # Terminal state - no transitions allowed

    # Branch naming conventions
    branch_patterns:
      feature: "build/week{week_number}-{feature_name}"
      hotfix: "hotfix/{feature_id}-{description}"
      integration: "integration/week{week_number}"

    # Commit message requirements
    commit_rules:
      require_semantic_versioning: true
      allowed_types:
        - feat
        - fix
        - refactor
        - test
        - docs
        - chore
        - style
      require_feature_id: false  # If true, commits must reference feature ID

# Feature dependencies define which features must be completed before others
dependencies:
  # Build 1B depends on nothing (it's part of the foundation)
  git-governance: []

  # CLI depends on feature registry and governance
  python-cli:
    - feature-registry
    - git-governance

  # FastAPI depends on feature registry
  fastapi-backend:
    - feature-registry
    - git-governance

  # Git hooks and MCP depend on governance and API
  git-hooks-mcp:
    - git-governance
    - python-cli
    - fastapi-backend

  # Migration tools can run independently
  migration-tools: []

  # Multi-repo dashboard depends on CLI
  multi-repo-dashboard:
    - python-cli

  # Optional integrations depend on API
  optional-integrations:
    - fastapi-backend

  # Documentation depends on all core features being complete
  documentation:
    - feature-registry
    - git-governance
    - python-cli
    - fastapi-backend
    - git-hooks-mcp

  # Packaging depends on documentation
  packaging:
    - documentation

  # Release depends on everything
  release:
    - feature-registry
    - git-governance
    - python-cli
    - fastapi-backend
    - git-hooks-mcp
    - optional-integrations
    - migration-tools
    - multi-repo-dashboard
    - documentation
    - packaging

# Validation rules define what must be checked before state transitions
validation:
  required_checks:
    - tests_pass
    - coverage_threshold
    - lint_pass
    - no_merge_conflicts

  coverage_threshold: 90  # Minimum test coverage percentage

  # Pre-commit checks
  pre_commit:
    - validate_features_json
    - check_governance_checksum
    - run_lint
    - check_no_debug_statements

  # Pre-push checks
  pre_push:
    - run_tests
    - check_coverage
    - validate_governance_rules

  # Pre-merge checks (for PRs)
  pre_merge:
    - all_tests_pass
    - coverage_above_threshold
    - no_unresolved_comments
    - approved_by_reviewer

# Enforcement policies control how strictly rules are applied
enforcement:
  policy: "strict"  # Options: strict, warn, off

  # What happens when rules are violated
  on_violation:
    pre_commit: "block"     # block, warn, or ignore
    pre_push: "block"       # block, warn, or ignore
    dependency: "block"     # block, warn, or ignore
    coverage: "warn"        # block, warn, or ignore

  # Exceptions for specific scenarios
  exceptions:
    allow_emergency_commits: false
    allow_skip_checks: false  # If true, can use --no-verify

# Git hooks configuration
hooks:
  enabled: true

  # Which hooks to install
  active_hooks:
    - pre-commit
    - post-commit
    - pre-push

  # Hook behavior
  pre_commit:
    validate_schema: true
    check_checksums: true
    run_linting: true
    format_code: true

  post_commit:
    regenerate_status: true
    update_metrics: true

  pre_push:
    run_tests: true
    check_coverage: true
    validate_dependencies: true

# Reporting and notifications
reporting:
  # Generate reports on governance violations
  track_violations: true
  violation_log: ".buildrunner/governance/violations.log"

  # Metrics to track
  metrics:
    - features_completed
    - tests_run
    - coverage_percentage
    - violations_count
    - build_time

# Security settings
security:
  # Require checksum verification for governance file
  require_checksum: true

  # Who can modify governance.yaml (optional - not enforced by code)
  authorized_editors:
    - project_owner
    - tech_lead

  # Alert on suspicious changes
  alert_on_governance_change: true
